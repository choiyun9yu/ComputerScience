# Micro Service Architecture

## 1. What is MSA?
### 1-1. 모놀리틱 시스템
- 소프트웨어 어플리케이션을 하나의 단일한 독립 시스템으로 구축하는 소프트웨어 아키텍처 스타일이다.
- 하나의 애플리케이션에 모든 비즈니스 로직을 통째로 모아놓은 구조이다.
- 모놀리틱 시스템은 소규모 프로젝트에 적합하고, 개발/빌드/배포/테스트 가 용이하며 인프라구조가 단순하여
  운영 비용 부담이 없다는 장점이 있다.
- 하지만 기업의 시스템 규모가 점점 커지고 복잡해지면서 모놀리틱 시스템의 단점이 부각된다.
- 작은 수정사항에도 전체 빌드 및 배포가 이뤄져야 해서 시간이 오래걸리고, 많은 양의 코드가 몰려 있어 유지보수가 어렵다.
- 일부 오류가 전체에 영향을 미치기도하고 스케일 아웃 설정이 복잡한 점 역시 문제가 된다.

### 1-2. MSA 
- MSA 는 모놀리틱 시스템의 대안으로 등장하였다.
- MSA 는 소프트웨어 시스템을 여러 작은 독립적인 서비스로 분할하여 개발하고 배포하는 방식이다.
- 하나의 애플리케이션을 구분 가능한 여러 개의 작은 서비스로 나눠 사용자의 요청을 처리하는 구조이다.
- 각 서비스별 소스 코드 수정이 쉽고, 수정한 서비스만 배포 가능하며, 배포 시 전체 서비스 중단이 없다.
- 또한 장애 시 해당 서비스에만 한정되고, 전체 장애로 확장될 가능성이 적다.
- 스케일 아웃이 필요한 경우에는 해당 서비스만 추가하여 리소스의 효율적 사용이 가능하다.

#### 스케일 아웃(scale-out)
- 스케일 아웃은 시스템의 성능을 향상시키기 위해 서버나 컴퓨터 노드의 개수를 늘려 처리 능력을 확장하는 방법니다.
- 이는 수평적 확장(horizontal sccaling)이라고도 하며, 단일 시스템의 성능을 높이기 위해 하드웨어를 즉강하는 스케일 업(scale-up, 수직정 확장)과는 대조적인 개념이다.
- 특징
  - 노드 추가: 새로운 서버나 컴퓨터 노드를 추가하여 시스템의 전체 처리 능력을 증가시킨다.
    이러한 노드는 종종 클러스터 형태로 구성되어 협력하여 작업을 처리한다.
  - 확장성: 필요에 따라 노드를 추가하거나 제거할 수 있으므로, 변화하는 부하에 유연하게 대응할 수 있다.
  - 비용 효율성: 기존 장비를 업그레이드하는 것보다 새로운, 저렴한 노드를 추가하는 것이 비용 효율적일 수 있다.
    특히 클라우드 환경에서는 필요에 따라 손쉽게 자원을 추가하거나 반환할 수 있어 비용 관리가 용이하다.
  - 고가용성: 여러 노드로 구성된 시스템에서는 한 노드에 문제가 생기더라도 다른 노드가 계속해서 서비스를 제공할 수 있다.
    이는 시스템의 신뢰성과 가용성을 높이는 데 기여한다.
  - 부하 분산: 여러 노드에 작업을 분산시킴으롰써 각 노드의 부하를 줄이고, 전체 시스템의 성능을 최적화할 수 있다.
    이를 통해 특정 노드에 과부하가 걸리는 것을 방지할 수 있다.
- 예시
  - 웹 서버: 웹 애플리케이션의 사용자 수가 증가할 때, 여러 웹 서버를 추가하여 트래픽을 분산 처리함으로써 성능을 유지할 수 있다.
  - 클라우드 서비스: 클라우드 플랫폼에서는 사용자의 요구에 맞추어 자동으로 인스턴스를 추가하여 스케일 아웃을 실행할 수 있다.
    이는 사용량에 따라 자원을 동적으로 할당하는 데 유리하다.
  - 빅데이터 처리: 대량의 데이터를 처리하는 시스템에서는 여러 노드를 활용하여 데이터 처리를 병렬화함으로써 작업 속도를 높일 수 있다.

### 1-3. MAS 아키텍처의 구성요소
1. Config Management: MSA 구조는 서비스의 재빌드/재부팅 없이 설정사항을 반영한다.
2. Service Discovery: 쿠버네티스의 기능을 통해 여러 개의 서비스 상태를 파악할 수 있고, 서비스 검색 및 등록 등 관리가 용이하다.
3. API Management: API 게이트웨이는 외부 요청과 내부 서비스 간의 통신을 관리하고 클라이언트의 접근 요청을 일원화한다.
4. Centralized Logging: 서비스 별로 록그가 나눠져있는 가운데, 이 로그를 중앙 집중하여 한 곳에서 관리할 수 있다.
5. Distributed Tracing: 마이크로서비스 간의 호출을 추적한다.
6. Centrailzed Monitoring: 여러 서비스의 정보를 중앙집중하여 복잡성을 줄이고 관리를 쉽게 한다.
7. Resillience & Fault Tolerance: MSA 구조에서 한 서비스의 오류가 다른 서비스에 파급 효과를 발생시키지 않도록 하기 위한 계단식 실패 방지 구조이다.
8. Auto Scaling & Self Healing: 부하 발생 시 자동 스케일 아웃 설정이 가능하고, 서비스 장애시 복구 자동화를 통해 서비스 관리를 효율적으로 할 수 있다.

#### API Gateway
- MSA 에서 게이트웨이는 클라이언트와 백엔드 마이크로서비스들 사이의 인터페이스로 작동한다.
- 다양한 기능을 제공하여 시스템의 효율성과 보안을 강화한다.
  1. **단일 진입점 제공**: 게이트웨이는 클라이언트가 여러 마이크로서비스에 직접 접근하지 않고, 하나의 진입점으로만 접근할 수 있도록 한다.
     이를 통해 클라이언트는 복잡한 서비스 구조를 인식할 필요 없이, 단순화된 인터페이스를 사용할 수 있다.
  2. **요청 라우팅**: 게이트웨이는 클라이언트로부터 받은 요청을 적절한 마이크로서비스로 라우팅한다.
     이를 통해 클라이언트는 특정 서비스의 위치나 구조에 대해 알 필요 없이 요청을 보낼 수 있다.
  3. **프로토콜 변환**: 서로 다른 프로토콜 간의 변환을 지원한다. 예를 들어 클라이언트가 HTTP 요청을 보내면
     이를 gRPC, WebSocket 등의 프로토콜로 변환하여 백엔드 서비스에 전달할 수 있다.
  4. **부하 분산**: 게이트웨이는 들어오는 요청을 여러 인스턴스에 분산시켜, 부하를 균등하게 분배함으로써 시스템의 성능을 최적화 한다.
  5. **인증 및 권한 부여**: API 게이트웨이는 사용자 인증 및 권한 부여를 처리하여, 민감한 데이터나 기능에 대한 접근을 제어할 수 있다.
     이를 통해 보안을 강화하고, 각 서비스가 개별적으로 인증을 처리할 필요를 줄여준다.
  6. **요청 집계**: 클라이언트가 여러 서비스에서 데이터를 가져와야 할 때, 게이트웨이가 이러한 요청을 집계하여 단일 응답으로 반환할 수 있다.
      이를 통해 네트워크 트래픽을 줄이고 클라이언트의 복잡성을 감소시킬 수 있다.
  7. **캐싱**: 게이트웨이는 자주 요청되는 데이터를 캐싱하여, 응답 시간을 줄이고 백엔드 서비스에 대한 부하를 줄일 수 있다.
  8. **로깅 및 모니터링**: 모든 요청과 응답을 로깅하여 시스템의 상태를 모니터링하고, 문제 발생 시 빠르게 대응할 수 있도록 지원한다.
  9. **속도 제한 및 트래픽 관리**: 게이트웨이는 속도 제한을 설정하여, 특정 클라이언트가 과도한 요청을 보내는 것을 방지함으로써 서비스의 안정성을 유지한다.
